# Требования к безопасности

## Защита данных
*** Шифрование передачи данных: ***
- Все коммуникации между системами должны использовать TLS 1.3 (минимум TLS 1.2).
- Для IoT-устройств (домофоны, шлагбаумы) — MQTT over TLS или gRPC с mTLS.

*** Шифрование хранения: *** 
- Биометрические шаблоны и номера автомобилей хранятся в зашифрованном виде (AES-256).
- Ключи шифрования управляются через HSM или KMS (например, AWS KMS, HashiCorp Vault).

##   Контроль доступа
*** Принцип минимальных привилегий: ***
- Партнёрская система получает только ID пользователя и разрешения (без ФИО, адреса и т. д.).
- Доступ к API ограничен по IP-белому списку и VPN.

*** Сегрегация данных: ***
- Данные одного собственника не должны быть доступны другому.
- Отдельные изолированные БД для разных жилых комплексов.

## Аутентификация и авторизация
*** Для пользователей: ***
- OAuth 2.0 + OpenID Connect (через Keycloak).
- Многофакторная аутентификация (MFA) для критичных операций (добавление биометрии).

*** Для систем: ***
- Mutual TLS (mTLS) для внутренних сервисов.
- JWT с коротким сроком жизни (1 час) для API-интеграций.

## Журналирование и мониторинг
*** Логирование всех событий: ***
- Попытки доступа, изменения настроек, ошибки интеграции.
- Логи хранятся минимум 6 месяцев.

*** Мониторинг угроз: ***
- SIEM-система для анализа аномалий.
- Алерты при подозрительной активности (например, 100 запросов/мин с одного IP).

## Соответствие законодательству
*** ФЗ-152 "О персональных данных": ***
- Явное согласие пользователя на обработку биометрии.
- Данные хранятся только на серверах в РФ.
- Возможность удаления данных по запросу.


# Протоколы аутентификации и авторизации

## Для пользователей
Вход в мобильное приложение: OAuth 2.0 (PKCE), интеграция с Keycloak.
Управление домофоном: JWT (Bearer Token), токен обновляется каждые 15 мин.

## Для систем
PropDevelopment → Партнёр: Сертификаты, подписанные внутренним CA.
IoT-устройства → Партнёр: Уникальные сертификаты для каждого устройства.


# Организация взаимодействия между системами

## Ключевые сценарии
*** Добавление биометрии: ***
- Пользователь загружает данные → даннык преобразуются в шаблон → шифруются → сохраняются в БД партнёра.
- PropDevelopment хранит только ID шаблона.

*** Открытие шлагбаума: ***
- Камера распознаёт номер → запрос в PropDevelopment → проверка прав → команда "открыть".

## Отказоустойчивость
Retry Policy: 3 попытки с экспоненциальной задержкой.
Circuit Breaker: Отключает интеграцию при 5 ошибках подряд.